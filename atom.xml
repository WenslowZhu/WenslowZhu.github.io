<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Zhu Ting Blog]]></title>
  <link href="https://wenslowzhu.github.io/atom.xml" rel="self"/>
  <link href="https://wenslowzhu.github.io/"/>
  <updated>2020-03-14T21:50:32+08:00</updated>
  <id>https://wenslowzhu.github.io/</id>
  <author>
    <name><![CDATA[]]></name>
    
  </author>
  <generator uri="http://www.mweb.im/">MWeb</generator>
  
  <entry>
    <title type="html"><![CDATA[åˆ›å»ºè·¨è‹¹æœå¹³å°çš„ Swift æ¡†æ¶]]></title>
    <link href="https://wenslowzhu.github.io/15847997558803.html"/>
    <updated>2020-03-21T22:09:15+08:00</updated>
    <id>https://wenslowzhu.github.io/15847997558803.html</id>
    <content type="html"><![CDATA[
<p><img src="media/15847997558803/IMG_2952.jpg" alt="IMG_2952" style="width:400px;"/></p>

<p>ä¸ºäº†ä½¿ä»£ç æ›´å®¹æ˜“ç»´æŠ¤å’Œéƒ¨ç½²ï¼Œä»¥åŠåœ¨ App ä¹‹é—´å…±äº«ï¼Œå¯ä»¥å°†åº•å±‚å¯å¤ç”¨çš„ä»£ç å­˜æ”¾åœ¨ç‹¬ç«‹çš„ Framework ä¸­è€Œä¸æ˜¯ App é¡¹ç›®ä¸­ã€‚åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ å¦‚ä½•é€šè¿‡ Xcode æ¥åˆ›å»º Swift Frameworkï¼Œå¹¶ä½¿å®ƒå¯åœ¨ iOSï¼ŒwatchOSï¼ŒtvOS å’Œ macOS App ä¸­ä½¿ç”¨ã€‚</p>

<span id="more"></span><!-- more -->

<blockquote>
<p>Xcode ç‰ˆæœ¬ 11.1<br/>
Swift ç‰ˆæœ¬ 5.0</p>
</blockquote>

<h2 id="toc_0">1. åˆ›å»ºé¡¹ç›®</h2>

<p>åˆ›å»ºä¸€ä¸ªåä¸º <strong>CrossPlatformSwiftModule</strong> çš„ Xcode é¡¹ç›®ï¼Œå¹¶é€‰æ‹© <strong>Cross-platform -&gt; Empty</strong></p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2123.30.18.png" alt="æˆªå±2020-03-2123.30.18"/></p>

<p>å®Œæˆåçš„é¡¹ç›®ä¸€è§ˆ</p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2123.33.56.png" alt="æˆªå±2020-03-2123.33.56"/><br/>
æ¥ç€æˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒå¹³å°åˆ›å»º Target äº†ã€‚ä»¥ iOS Target ä¸ºä¾‹ã€‚ç‚¹å‡» â• æŒ‰é’®ï¼Œé€‰æ‹©  <strong>iOS -&gt; Framework &amp; Library -&gt; Framework</strong>ã€‚Target å‘½åä¸º <strong>CrossPlatformSwiftModule_iOS</strong>ã€‚</p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2123.45.51.png" alt="æˆªå±2020-03-2123.45.51"/></p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2123.49.39.png" alt="æˆªå±2020-03-2123.49.39"/></p>

<p>å¦‚æ³•ç‚®åˆ¶ï¼Œæˆ‘ä»¬æ¥ç€åˆ›å»º watchOSï¼ŒtvOS å’Œ macOS çš„ Frameworkã€‚</p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2123.56.48.png" alt="æˆªå±2020-03-2123.56.48"/></p>

<p>ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºçš„ Sources çš„ç©ºæ–‡ä»¶å¤¹ï¼Œå®ƒä¹Ÿæ˜¯æˆ‘ä»¬å­˜æ”¾æºä»£ç çš„åœ°æ–¹ã€‚</p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2200.04.05.png" alt="æˆªå±2020-03-2200.04.05"/></p>

<h2 id="toc_1">2. Info.plist æ–‡ä»¶</h2>

<p>æˆ‘ä»¬å°† iOS framework æ–‡ä»¶å¤¹ä¸‹çš„ Info.plist æ–‡ä»¶å¤åˆ¶åˆ° <strong>Sources/SupportingFiles</strong> æ–‡ä»¶å¤¹ä¸‹ã€‚è¿™ä¸ª Info.plist ä¼šè¢«æ‰€æœ‰å¹³å°å…±äº«ã€‚</p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2200.10.11.png" alt="æˆªå±2020-03-2200.10.11"/></p>

<p>åœ¨ <strong>Sources/SupportingFiles</strong> æ–‡ä»¶å¤¹ä¸Šå³é”®ï¼Œå¹¶é€‰æ‹© <strong>Add Files</strong></p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2200.10.20.png" alt="æˆªå±2020-03-2200.10.20"/></p>

<p>é€‰æ‹©æ·»åŠ åˆšåˆšå¤åˆ¶è¿‡å»çš„ Info.plist æ–‡ä»¶ã€‚æ³¨æ„âš ï¸<strong>ä¸è¦é€‰ä¸­ Copy items if needed</strong>ã€‚</p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2200.11.01.png" alt="æˆªå±2020-03-2200.11.01"/></p>

<p>å°†å„ä¸ª Framework æ–‡ä»¶å¤¹ä¸‹çš„ Info.plist æ–‡ä»¶åˆ é™¤ã€‚åªä¿ç•™ <strong>Sources/SupportingFiles</strong> æ–‡ä»¶å¤¹ä¸‹çš„ Info.plist æ–‡ä»¶ã€‚</p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2200.19.57.png" alt="æˆªå±2020-03-2200.19.57"/></p>

<p>æ¥ç€åœ¨ Targets ä¸­é€‰ä¸­ CrossPlatformSwiftModule_iOS -&gt; Build Settings -&gt; Packaging -&gt; Info.plist Fileã€‚å°†å€¼æ›´æ”¹ä¸º Sources/SupportingFiles/Info.plistã€‚</p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2200.23.33.png" alt="æˆªå±2020-03-2200.23.33"/></p>

<p>åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¸ºå¦å¤–çš„ä¸‰ä¸ª Framework ä¹ŸåšåŒæ ·çš„é…ç½®ã€‚å®Œæˆè®¾ç½®åå†ç¡®è®¤ä¸€ä¸‹ï¼Œæ˜¯å¦æ‰€æœ‰ Target éƒ½èƒ½æˆåŠŸåŠ è½½ Info é€‰é¡¹æ ‡ç­¾ã€‚</p>

<h2 id="toc_2">3. Header Files</h2>

<p>ä¸ºäº†ä½¿ OC é¡¹ç›®å¯ä»¥æˆåŠŸæ¡¥æ¥æˆ‘ä»¬çš„ Swift Frameworkï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹ .h æ–‡ä»¶åšé¢å¤–çš„è®¾ç½®ã€‚</p>

<p>å°† <strong>CrossPlatformSwiftModule_iOS</strong> æ–‡ä»¶å¤¹ä¸‹çš„ <strong>CrossPlatformSwiftModule_iOS.h</strong> æ–‡ä»¶æ‹·è´åˆ° Sources/SupportingFiles ä¸­ã€‚å¹¶å°†æ‹–å…¥åˆ° Xcode çš„ Sources/SupportingFiles æ–‡ä»¶å¤¹ä¸­</p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2210.50.18.png" alt="æˆªå±2020-03-2210.50.18"/></p>

<p>åˆ é™¤ <strong>CrossPlatformSwiftModule_iOS.h</strong> æ–‡ä»¶é‡Œçš„æ‰€æœ‰ &quot;_iOS&quot;ï¼Œå¹¶å°†è¯¥æ–‡ä»¶é‡å‘½åä¸º <strong>CrossPlatformSwiftModule.h</strong>ã€‚é€‰ä¸­ <strong>CrossPlatformSwiftModule.h</strong> æ–‡ä»¶ï¼Œå°†å…¶å‹¾é€‰åˆ°æ‰€æœ‰ Target ä¸­ï¼Œå¹¶è®¾ç½®ä¸º Publicã€‚</p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2210.52.54.png" alt="æˆªå±2020-03-2210.52.54"/><br/>
æ­¤æ—¶å¯ä»¥å°†é¡¹ç›®ä¸­é™¤ Sources æ–‡ä»¶å¤¹ä¹‹å¤–çš„å…¶ä»–æ–‡ä»¶å¤¹å…¨éƒ¨åˆ æ‰ã€‚</p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2210.56.52.png" alt="æˆªå±2020-03-2210.56.52"/></p>

<h2 id="toc_3">4. æ·»åŠ ä»£ç </h2>

<p>å®Œå–„ä¸Šè¿°çš„æ‰€æœ‰è®¾ç½®ä¹‹åï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥å¼€å§‹æ·»åŠ ä»£ç äº†ã€‚å°è¯•ç€æ–°å»ºä¸€ä¸ªä»£ç æ–‡ä»¶å§ã€‚è®°å¾—æ·»åŠ ä»£ç æ—¶ï¼Œè¦å‹¾é€‰ä¸Šæ‰€æœ‰ Targetã€‚</p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2210.58.47.png" alt="æˆªå±2020-03-2210.58.47"/></p>

<h2 id="toc_4">5. åœ¨ä»£ç å±‚é¢é€‚é…å¤šå¹³å°</h2>

<p>ä¸åŒçš„å¹³å°ä½¿ç”¨ä¸åŒçš„ç³»ç»Ÿæ¡†æ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¸ºä¸åŒçš„å¹³å° import ä¸åŒçš„ç³»ç»Ÿæ¡†æ¶ã€‚</p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2211.09.17.png" alt="æˆªå±2020-03-2211.09.17"/></p>

<p>é™¤äº†å¯ä»¥ import ä¸åŒçš„ç³»ç»Ÿæ¡†æ¶ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦è‡ªå®šä¹‰è·¨å¹³å°çš„æ•°æ®ç±»å‹ã€‚</p>

<p><img src="media/15847997558803/%E6%88%AA%E5%B1%8F2020-03-2211.12.40.png" alt="æˆªå±2020-03-2211.12.40"/></p>

<p>è¿™æ ·è®¾ç½®åï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„ <strong>ImageType</strong> ç±»å‹å°±å¯ä»¥è·¨å¹³å°ä½¿ç”¨äº†ã€‚</p>

<h2 id="toc_5">å°ç»“</h2>

<p>ç›¸ä¿¡ç°åœ¨ä½ å·²ç»æŒæ¡äº†å¦‚ä½•åˆ›å»ºè·¨å¹³å°çš„ Swift Frameworkã€‚é€šè¿‡ä¸Šè¿°çš„æ–¹æ³•ï¼Œå¯ä»¥å°†ä¸€å¥—ä»£ç éƒ¨ç½²åˆ°å¤šä¸ªå¹³å°ï¼Œæ–¹ä¾¿çœäº‹ğŸ˜‰ã€‚</p>

<p><a href="https://github.com/WenslowZhu/CrossPlatformSwiftModule">Demo çš„ Github åœ°å€</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swift - é€šè¿‡åè®® Protocol å…±äº«ä»£ç ]]></title>
    <link href="https://wenslowzhu.github.io/15841670639825.html"/>
    <updated>2020-03-14T14:24:23+08:00</updated>
    <id>https://wenslowzhu.github.io/15841670639825.html</id>
    <content type="html"><![CDATA[
<p><img src="media/15841670639825/IMG_2944.jpg" alt="IMG_2944" style="width:400px;"/></p>

<p>å¸¸ç”¨å…±äº«ä»£ç çš„æ–¹å¼æœ‰ï¼šç»§æ‰¿ã€æ‹“å±•å’Œå…¨å±€æ–¹æ³•ã€‚ä»Šå¤©ç¬”è€…åˆ†äº«ä¸€ç§é€šè¿‡ Protocol å…±äº«ä»£ç çš„æŠ€å·§ã€‚</p>

<span id="more"></span><!-- more -->

<h2 id="toc_0">å‡†å¤‡å·¥ä½œ</h2>

<p>æˆ‘ä»¬å…ˆæ„å»ºä¸€ä¸ªç±»ï¼Œä¸€ä¸ªç»“æ„ä½“å’Œä¸€ä¸ªæšä¸¾ã€‚å®ƒä»¬éƒ½æœ‰ä¸€ä¸ª <code>String</code> ç±»å‹çš„å±æ€§ <code>name</code>ã€‚è€Œä¸”å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªå« <code>printName</code> çš„æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥è¾“å‡º <code>name</code>ã€‚</p>

<pre><code class="language-swift">class PersonClass {
    let name = &quot;David&quot;
    
    func printName(){
        print(name)
    }
}

struct PersonStruct {
    let name = &quot;David&quot;
    
    func printName(){
        print(name)
    }
}

enum PersonEnum {
    var name: String {
        return &quot;David&quot;
    }
    
    case someone
    
    func printName() {
        print(name)
    }
}
</code></pre>

<p>å› ä¸º <code>PersonClass</code> ï¼Œ <code>PersonStruct</code> å’Œ <code>PersonEnum</code> çš„ <code>printName</code> æ–¹æ³•æ‰€åšçš„ä¸šåŠ¡æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œæ‰€ä»¥æŠŠè¿™æ–¹æ³•æŠ½ç¦»å‡ºæ¥æ”¾åœ¨ä¸€ä¸ªç»Ÿä¸€çš„åœ°æ–¹ï¼Œä¼šæ›´æ–¹ä¾¿ç»´æŠ¤å’Œæ‹“å±•ã€‚</p>

<h2 id="toc_1">æ„å»ºåè®®</h2>

<p>æˆ‘ä»¬å…ˆæ„å»ºä¸€ä¸ªåä¸º <code>PrintNameProtocol</code> çš„åè®®ã€‚åœ¨è¿™ä¸ªåè®®é‡Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª <code>String</code> ç±»å‹çš„æ¥å£ <code>name</code>ã€‚å¹¶åœ¨æ‹“å±•ä¸­æ·»åŠ ä¸€ä¸ªå…·ä½“çš„å®ç°æ–¹æ³• <code>printName</code>ã€‚</p>

<pre><code class="language-swift">protocol PrintNameProtocol {
    var name: String { get }
}

extension PrintNameProtocol {
    func printName() {
        print(name)
    }
}
</code></pre>

<p>æ¥ç€æˆ‘ä»¬è®© <code>PersonClass</code>ï¼Œ<code>PersonStruct</code> å’Œ <code>PersonEnum</code>  å»å®ç°è¿™ä¸ªåè®®ã€‚</p>

<pre><code class="language-swift">class PersonClass: PrintNameProtocol {
    let name = &quot;David&quot;
}

struct PersonStruct: PrintNameProtocol {
    let name = &quot;David&quot;
}

enum PersonEnum: PrintNameProtocol {
    var name: String {
        return &quot;David&quot;
    }
    
    case someone
}
</code></pre>

<p>å› ä¸º <code>PersonClass</code>ï¼Œ<code>PersonStruct</code> å’Œ <code>PersonEnum</code> éƒ½æœ‰ <code>String</code> ç±»å‹çš„å±æ€§ <code>name</code>ï¼Œæ‰€ä»¥å®ƒä»¬éƒ½æ˜¯å®ç°äº† <code>PrintNameProtocol</code> æ‰€å®šä¹‰çš„æ¥å£çš„ã€‚æ¥ç€ï¼Œæˆ‘ä»¬åˆ é™¤ <code>printName</code> æ–¹æ³•ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•å·²ç»åœ¨ <code>PrintNameProtocol</code> ä¸­å®ç°äº†ã€‚</p>

<h2 id="toc_2">ä½¿ç”¨å…±äº«ä»£ç </h2>

<p>æ¥ç€æˆ‘ä»¬åˆå§‹åŒ–ä¸€ä¸ª <code>personClass</code> ç±»å¯¹è±¡ï¼Œä¸€ä¸ª<code>personStruct</code> ç»“æ„ä½“å’Œä¸€ä¸ªæšä¸¾ <code>personEnum</code>ã€‚å¹¶è°ƒç”¨ä¸€ä¸‹ <code>printName</code> æ–¹æ³•ã€‚</p>

<pre><code class="language-swift">let personClass = PersonClass()
let personStruct = PersonStruct()
let personEnum = PersonEnum.someone

personClass.printName()
personStruct.printName()
personEnum.printName()
</code></pre>

<p>æ§åˆ¶å°è¾“å‡ºï¼š</p>

<pre><code class="language-swift">David
David
David
</code></pre>

<h2 id="toc_3">æ‹“å±•å…±äº«ä»£ç </h2>

<p>ä¸‹é¢æˆ‘ä»¬å†æ‹“å±•ä¸€ä¸‹ <code>printName</code> è¿™ä¸ªæ–¹æ³•ã€‚</p>

<pre><code class="language-swift">extension PrintNameProtocol {
    func printName() {
        print(&quot;Hello! My name is \(name)&quot;)
    }
}
</code></pre>

<p>é‡æ–°è¿è¡Œä»£ç åï¼Œæ§åˆ¶å°è¾“å‡ºï¼š</p>

<pre><code class="language-swift">Hello! My name is David
Hello! My name is David
Hello! My name is David
</code></pre>

<h2 id="toc_4">å°ç»“</h2>

<p>é€šè¿‡æ‹“å±•åè®®ï¼Œæˆ‘ä»¬å®ç°äº†åœ¨ç±»ã€ç»“æ„ä½“å’Œæšä¸¾ä¸­å…±äº«ä»£ç ã€‚è¿™ç§æ–¹å¼æ¯”ç»§æ‰¿æ›´ä¸ºçµæ´»å’Œå¼ºå¤§ã€‚è¿™ç§å…±äº«çš„æ–¹å¼ä¹Ÿæ–¹ä¾¿æˆ‘ä»¬å»ç»´æŠ¤å’Œæ‹“å±•æŸäº›ä¸šåŠ¡ä»£ç ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swift å†…å­˜ç®¡ç†ä¹‹ weak ä¸ unowned]]></title>
    <link href="https://wenslowzhu.github.io/15841648059621.html"/>
    <updated>2020-03-14T13:46:45+08:00</updated>
    <id>https://wenslowzhu.github.io/15841648059621.html</id>
    <content type="html"><![CDATA[
<p><img src="media/15841648059621/1374191-d95813de95a5db93.jpg" alt="1374191-d95813de95a5db93"/></p>

<p>åœ¨ç”¨ Swift åšå¼€å‘æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <strong>weak</strong> æˆ–æ˜¯ <strong>unowned</strong> æ‰“ç ´ç±»å®ä¾‹å’Œé—­åŒ…çš„å¼ºå¼•ç”¨å¾ªç¯ã€‚ä»Šå¤©æˆ‘ä»¬æ¥èŠä¸€èŠ <strong>weak</strong> å’Œ <strong>unowned</strong> çš„ç›¸åŒå’Œä¸åŒä¹‹å¤„ã€‚</p>

<span id="more"></span><!-- more -->

<h2 id="toc_0">weak</h2>

<p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç”¨ <strong>weak</strong> æ¥æ ‡è®°ä»£ç†æˆ–è€…åœ¨é—­åŒ…ä¸­ä½¿ç”¨å®ƒæ¥é¿å…å¼•ç”¨å¾ªç¯ã€‚</p>

<pre><code class="language-swift">weak var delegate: SomeDelegate?

lazy var someClosure: () -&gt; Void = { [weak self] in
    guard let self = self else { retrun }
    self.balabala
}
</code></pre>

<p>å½“æˆ‘ä»¬èµ‹å€¼ç»™ä¸€ä¸ªè¢«æ ‡è®° <strong>weak</strong> çš„å˜é‡æ—¶ï¼Œå®ƒçš„å¼•ç”¨è®¡æ•°ä¸ä¼šè¢«æ”¹å˜ã€‚è€Œä¸”å½“è¿™ä¸ªå¼±å¼•ç”¨å˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«é‡Šæ”¾æ—¶ï¼Œè¿™ä¸ªå˜é‡å°†è¢«è‡ªåŠ¨è®¾ä¸º <strong>nil</strong>ã€‚<strong>è¿™ä¹Ÿæ˜¯å¼±å¼•ç”¨å¿…é¡»è¢«å£°æ˜ä¸º Optional çš„åŸå› ã€‚</strong></p>

<h2 id="toc_1">unowned</h2>

<p>å’Œ <strong>weak</strong> ç›¸åŒï¼Œ<strong>unowned</strong> ä¹Ÿå¯ä»¥åœ¨ä¸å¢åŠ å¼•ç”¨è®¡æ•°çš„å‰æä¸‹ï¼Œå¼•ç”¨æŸä¸ªç±»å®ä¾‹ã€‚</p>

<pre><code class="language-swift">unowned let someInstance: SomeClass

lazy var someClosure: () -&gt; Void = { [unowned self] in
    self.balabala
}
</code></pre>

<p>åœ¨ä½¿ç”¨ <strong>unowned</strong> æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦å°†å˜é‡å£°æ˜ä¸º <strong>Optional</strong>ã€‚</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ã€‚å¯¹äºè¢« <strong>unowned</strong> æ ‡è®°çš„å˜é‡ï¼Œå³ä½¿å®ƒçš„åŸæ¥å¼•ç”¨å·²ç»è¢«é‡Šæ”¾ï¼Œå®ƒä»ç„¶ä¼šä¿æŒå¯¹è¢«å·²ç»é‡Šæ”¾äº†çš„å¯¹è±¡çš„ä¸€ä¸ª &quot;æ— æ•ˆçš„&quot; å¼•ç”¨ï¼Œå®ƒä¸æ˜¯ <strong>Optional</strong> ï¼Œä¹Ÿä¸ä¼šè¢«æŒ‡å‘ <strong>nil</strong>ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬è¯•å›¾è®¿é—®è¿™æ ·çš„ <strong>unowned</strong> å¼•ç”¨æ—¶ï¼Œç¨‹åºå°±ä¼šå‘ç”Ÿé”™è¯¯ã€‚</p>

<p>æˆ‘ä»¬çœ‹ä¸‹è¾¹è¿™æ®µç¤ºä¾‹ä»£ç ï¼š</p>

<pre><code class="language-swift">class SomeSingleton {
    
    static let share = SomeSingleton()
    
    func closure(closure: (() -&gt; Void)?) {
        DispatchQueue.global().asyncAfter(deadline: .now() + 2) {
            closure?()
        }
    }
}

class Person {
    
    let someSingleton = SomeSingleton.share
    let name = &quot;Hello&quot;
    
    func testClosure() {
        someSingleton.closure { [unowned self] in
            print(self.name)
        }
    }
    
    deinit {
        print(&quot;Person is deinited&quot;)
    }
}

class ViewController: UIViewController {
    
    var person: Person?
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        person = Person()
        
        person?.testClosure()
        
        person = nil
    }
}
</code></pre>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå•ä¾‹ï¼Œè¿™ä¸ªå•ä¾‹æä¾›ä¸€ä¸ªä¸¤ç§’ä¹‹åè§¦å‘çš„é—­åŒ…ã€‚æ¥ç€æˆ‘ä»¬åˆåœ¨ <code>Person</code> è¿™ä¸ªç±»ä¸­å¼•ç”¨è¿™ä¸ªå•ä¾‹ã€‚æœ€åï¼Œæˆ‘ä»¬åœ¨ <code>ViewController</code> ä¸­å®ä¾‹åŒ–ä¸€ä¸ª <code>Person</code> å¯¹è±¡ï¼Œå¹¶åœ¨è°ƒç”¨ <code>testClosure()</code> æ–¹æ³•åï¼Œå°†å…¶è®¾ä¸º <strong>nil</strong>ã€‚</p>

<p>åœ¨ç¨‹åºè¿è¡Œä¹‹åï¼Œæˆ‘ä»¬è§‚å¯Ÿæ§åˆ¶å°çš„ logã€‚<code>person</code> è¢« <code>denint</code> åï¼Œæ§åˆ¶å°æ‰“å°å‡ºäº† <code>Person is deinited</code>ã€‚åœ¨ä¸¤ç§’åï¼Œå•ä¾‹çš„é—­åŒ…è¢«è§¦å‘ï¼Œç¨‹åºå°è¯•è®¿é—® <code>person</code> çš„ <code>name</code> å±æ€§ã€‚ç”±äº <code>person</code> åœ¨æ­¤æ—¶å·²ç»æ˜¯ <strong>nil</strong>ï¼Œæˆ‘ä»¬æ­£åœ¨å°è¯•è¯»å–ä¸€ä¸ªå·²ç»è¢«é‡Šæ”¾ï¼Œä½† <strong>unowned reference</strong> è¿˜å­˜åœ¨ä½†å¯¹è±¡ã€‚æ‰€ä»¥ç¨‹åºæŠ›å‡ºäº†å¼‚å¸¸ã€‚</p>

<pre><code class="language-text">Person is deinited
Fatal error: Attempted to read an unowned reference but object 0x6000027b5bf0 was already deallocated2019-04-20
</code></pre>

<p>å¦‚æœæˆ‘ä»¬å°† <code>[unowned self]</code> æ›¿æ¢ä¸º <code>[weak self]</code>ï¼Œå†é‡æ–°è¿è¡Œä¸€éç¨‹åºã€‚</p>

<pre><code class="language-swift">someSingleton.closure { [weak self] in
    print(self?.name)
}
</code></pre>

<p>è§‚å¯Ÿæ§åˆ¶å°çš„logã€‚åœ¨ <code>person</code> è¢«è®¾ç½®ä¸º <strong>nil</strong> ä¸¤ç§’ä¹‹åï¼Œå•ä¾‹é—­åŒ…è¢«è§¦å‘ã€‚ç”±äºæˆ‘ä»¬åœ¨é—­åŒ…ä¸­ä½¿ç”¨äº† <strong>weak</strong>ï¼Œæ‰€ä»¥ç¨‹åºä¸ä¼šå‡ºé”™ï¼Œ<code>self?.name</code> çš„å€¼ä¸º <strong>nil</strong>ã€‚</p>

<pre><code class="language-text">Person is deinited
nil
</code></pre>

<h2 id="toc_2">weak vs. unowned</h2>

<blockquote>
<p>Define a capture in a closure as an unowned reference when the closure and the instance it captures will always refer to each other, and will always be deallocated at the same time.</p>

<p>Conversely, define a capture as a weak reference when the captured reference may become nil at some point in the future. Weak references are always of an optional type, and automatically become nil when the instance they reference is deallocated. This enables you to check for their existence within the closureâ€™s body.</p>
</blockquote>

<p>æ ¹æ®è‹¹æœçš„å®˜æ–¹æ–‡æ¡£çš„å»ºè®®ã€‚å½“æˆ‘ä»¬çŸ¥é“ä¸¤ä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå¹¶ä¸ç›¸å…³ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ <strong>weak</strong>ã€‚ç›¸åï¼Œéå¼ºå¼•ç”¨å¯¹è±¡æ‹¥æœ‰å’Œå¼ºå¼•ç”¨å¯¹è±¡åŒæ ·æˆ–è€…æ›´é•¿çš„ç”Ÿå‘½å‘¨æœŸçš„è¯ï¼Œåˆ™åº”è¯¥ä½¿ç”¨ <strong>unowned</strong>ã€‚</p>

<p>ä¾‹å¦‚ï¼Œ<code>ViewControler</code> å¯¹å®ƒçš„ <code>SubView</code> çš„å¼•ç”¨å¯ä»¥ä½¿ç”¨ <strong>unowned</strong>ã€‚å› ä¸º <code>ViewControler</code> çš„ç”Ÿå‘½å‘¨æœŸä¸€å®šæ¯”å¯¹å®ƒçš„ <code>SubView</code> é•¿ã€‚</p>

<p>è€Œåœ¨ä½¿ç”¨æœåŠ¡æ—¶ï¼Œåˆ™éœ€è¦çœ‹æƒ…å†µä½¿ç”¨ <strong>weak</strong>ã€‚å› ä¸ºæœåŠ¡çš„åˆå§‹åŒ–æ–¹æ³•å¯èƒ½æ˜¯è¢«å·¥å‚æ¨¡å¼æˆ– <strong>Service Locator</strong> æ‰€å°è£…ã€‚è¿™äº›æœåŠ¡å¯èƒ½åœ¨æŸäº›æ—¶å€™è¢«é‡æ„ä¸ºå•ä¾‹ï¼Œæ­¤æ—¶å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸå‘ç”Ÿäº†æ”¹å˜ã€‚</p>

<h2 id="toc_3">æ•è·åˆ—è¡¨</h2>

<p>é™¤äº†å¸¸ç”¨çš„ <strong>weak self</strong> å’Œ <strong>unowned self</strong> ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<strong>æ•è·åˆ—è¡¨</strong>æ¥æ‰“ç ´é—­åŒ…å¼•ç”¨å¾ªç¯ã€‚å°†éœ€è¦è¢«æ•è·çš„å˜é‡ï¼Œç”¨ <strong>weak self</strong> æˆ– <strong>unowned self</strong> æ ‡è®°ã€‚</p>

<pre><code class="language-swift">someSingleton.closure { [weak portrait] in
    print(portrait)
}

/* æˆ–è€… */

someSingleton.closure { [unowned portrait] in
    print(portrait)
}
</code></pre>

<p><strong>æ•è·åˆ—è¡¨</strong>ä¹Ÿå¯ä»¥ç”¨æ¥åˆå§‹åŒ–æ–°çš„å˜é‡</p>

<pre><code class="language-swift">/* ç”±äº UIImageView(image: portrait) è¿”å› Optional çš„å€¼ï¼Œ
è€Œ unowned ä¸å¯ä»¥ç”¨æ¥æ ‡ç¤º Optional çš„å˜é‡ï¼Œ
æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦å¼ºåˆ¶è§£åŒ…ã€‚ */

someSingleton.closure { [unowned imageView = UIImageView(image: portrait)!] in
    print(imageView)
}

/* æˆ–è€… */

someSingleton.closure { [weak imageView = UIImageView(image: portrait)] in
    print(imageView)
}
</code></pre>

<p>æ­¤æ—¶ç¼–è¯‘å™¨ä¼šç»™å‡ºè­¦å‘Šã€‚å› ä¸ºè¿™äº›å˜é‡çš„ä½œç”¨åŸŸåªåœ¨é—­åŒ…å†…éƒ¨ã€‚</p>

<pre><code class="language-text">Instance will be immediately deallocated because variable &#39;imageView&#39; is &#39;unowned&#39;

/* æˆ–è€… */

Instance will be immediately deallocated because variable &#39;imageView&#39; is &#39;weak&#39;
</code></pre>

<blockquote>
<p>å‚è€ƒï¼š<a href="https://docs.swift.org/swift-book/LanguageGuide/AutomaticReferenceCounting.html">Automatic Reference Counting</a></p>
</blockquote>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Core Data çš„ Delete Rule è¯¦è§£]]></title>
    <link href="https://wenslowzhu.github.io/15841636525875.html"/>
    <updated>2020-03-14T13:27:32+08:00</updated>
    <id>https://wenslowzhu.github.io/15841636525875.html</id>
    <content type="html"><![CDATA[
<p><img src="media/15841636525875/1374191-1df5dd48c1de988c.jpg" alt="1374191-1df5dd48c1de988"/></p>

<p>åœ¨é…ç½® <strong>Core Data</strong> çš„ <strong>relationship</strong> æ—¶æœ‰ä¸€ä¸ªå±æ€§å« <strong>Delete Rule</strong>ã€‚<strong>Delete Rule</strong> è¡¨æ˜äº†æ•°æ®å¯¹è±¡åœ¨è¢«åˆ é™¤æ—¶ï¼Œå’Œä»–æœ‰ <strong>relationship</strong> çš„å…¶ä»–æ•°æ®å¯¹è±¡çš„å¤„ç†è§„åˆ™ã€‚</p>

<span id="more"></span><!-- more -->

<p><img src="https://user-gold-cdn.xitu.io/2019/4/20/16a39e3c6a4ef1d2?w=538&amp;h=558&amp;f=png&amp;s=148770" alt="Delete Rule"/></p>

<h2 id="toc_0">Deny</h2>

<p>é™¤éæœ‰ <strong>relationship</strong> çš„å…¶ä»–æ•°æ®å¯¹è±¡å…¨éƒ¨è¢«åˆ é™¤ï¼Œå¦åˆ™è¯¥æ•°æ®å¯¹è±¡å°†æ— æ³•è¢«åˆ é™¤ã€‚</p>

<blockquote>
<p>ä½ åœ¨æ’¤é”€ä¸€ä¸ªäº‹ä¸šéƒ¨é—¨å‰ï¼Œéœ€è¦å…ˆå°†éƒ¨é—¨å‘˜å·¥å…¨éƒ¨ fireã€‚</p>
</blockquote>

<h2 id="toc_1">Cascade</h2>

<p>å½“ä½ åˆ é™¤ä¸€ä¸ªæ•°æ®å¯¹è±¡æ—¶ï¼Œæœ‰ <strong>relationship</strong> çš„å…¶ä»–æ•°æ®å¯¹è±¡å°†ä¸€å¹¶è¢«è‡ªåŠ¨åˆ é™¤ã€‚</p>

<blockquote>
<p>ä½ æ’¤é”€äº†ä¸€ä¸ªäº‹ä¸šéƒ¨é—¨ï¼Œè¯¥éƒ¨é—¨çš„å‘˜å·¥åœ¨åŒä¸€æ—¶é—´ä¸€å¹¶è¢« fire ã€‚</p>
</blockquote>

<h2 id="toc_2">Nullify</h2>

<p>å½“ä½ åˆ é™¤ä¸€ä¸ªæ•°æ®å¯¹è±¡æ—¶ï¼Œæœ‰ <strong>relationship</strong> çš„å…¶ä»–æ•°æ®å¯¹è±¡çš„ <strong>relationship</strong> æŒ‡é’ˆå°†è¢«è®¾ç½®ä¸º <strong>null</strong>ã€‚</p>

<p>åªæœ‰å½“ <strong>relationship</strong> æ˜¯ <strong>Optional</strong> æ—¶ï¼Œè¯¥è®¾ç½®æ‰æ˜¯æœ‰æ„ä¹‰çš„ã€‚å¦åˆ™ï¼Œä½ å¿…é¡»åœ¨åˆ é™¤å‰ï¼Œä¸ºæœ‰ <strong>relationship</strong> çš„æ•°æ®å¯¹è±¡æ‰‹åŠ¨è®¾ç½®æ–°çš„ <strong>relationship</strong>ã€‚</p>

<h2 id="toc_3">No Action</h2>

<p>æ­£å¦‚å…¶åã€‚åœ¨åˆ é™¤æ—¶ï¼Œä¸åšå¯¹ <strong>relationship</strong> ä»»ä½•æ“ä½œã€‚</p>

<p><strong>æ³¨æ„</strong>âš ï¸</p>

<p>å½“ä½ ä½¿ç”¨è¿™ç§åˆ é™¤è§„åˆ™æ—¶ï¼Œæ‰€æœ‰çš„ <strong>relationship</strong> éƒ½éœ€è¦ä½ æ‰‹åŠ¨ç®¡ç†ã€‚ </p>

]]></content>
  </entry>
  
</feed>
